<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.web10.project.dao.ProjectDao">
    <insert id="insert" parameterType="com.example.web10.project.vo.ProjectVo">
        INSERT INTO
            project
                (pr_name,
                pr_start_date,
                pr_end_date,
                pro_desc,
                cr_id)
            VALUES
                (#{pname},
                #{prStartDate},
                #{prEndDate},
                #{proDesc},
                #{crId});
    </insert>

    <select id="search" parameterType="com.example.web10.project.vo.RequestProjectListVo" resultType="com.example.web10.project.vo.ProjectVo">
        SELECT p.p_id,
               p.pr_name,
               p.pr_start_date,
               p.pr_end_date,
               p.pro_desc,
               p.cr_id,
               p.chng_nm,
               u.username
        FROM project p
            LEFT JOIN users u
        ON u.id = p.cr_id
            WHERE u.del_altv = false
        <if test="pname != '' and pname != null">
            AND pr_name = #{pname}
        </if>
        <if test="proDesc != '' and proDesc != null">
            AND pro_desc = #{proDesc}
        </if>
        ORDER BY p.p_id ASC;
    </select>
    <select id="checkExist" parameterType="com.example.web10.project.vo.RequestProjectListVo">
        SELECT count(pr.pr_name)
            FROM project pr
        LEFT JOIN users u
            ON  pr.cr_id = u.id
        WHERE u.del_altv = false
        <if test="pname != '' and pname != null">
            AND pr_name = #{pname}
        </if>
        <if test="proDesc != '' and proDesc != null">
            AND pro_desc = #{proDesc}
        </if>

    </select>
    <select id="checkId" parameterType="com.example.web10.project.vo.RequestProjectUpdateVo">
        SELECT count(pr.pr_name)
            FROM project pr
        INNER JOIN users u
            ON pr.cr_id = u.id
        WHERE pr.p_id = #{pid} AND u.del_altv = false;
    </select>

    <select id="checkUid" parameterType="com.example.web10.project.vo.RequestProjectVo">
        SELECT count(username)
        FROM users WHERE id IN (#{crId});
    </select>

    <update id="update" parameterType="com.example.web10.project.vo.RequestProjectUpdateVo">
        UPDATE project
            SET pr_name = #{pname},
        pro_desc = #{proDesc},
            chng_nm = chng_nm + 1
        WHERE p_id = #{pid};
    </update>
</mapper>